<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowBridge</title>
    <link rel="stylesheet" href="/css/modern.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@700&family=JetBrains+Mono:wght@400;500&family=Instrument+Serif:ital@0;1&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="app-title">
                FlowBridge
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.77 10-10 10Z"></path>
                    <path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path>
                </svg>
            </div>
            <div class="app-controls">
                <button class="btn btn-primary" id="newTaskBtn">
                    <span>+</span> New Task
                </button>
                <button class="btn btn-secondary" id="refreshBtn">
                    Refresh
                </button>
                <button class="btn btn-secondary" id="viewArchiveBtn">
                    Archive
                </button>
                <button class="btn btn-secondary btn-icon" id="preferencesBtn" aria-label="Preferences">
                    <i data-feather="settings"></i>
                </button>
            </div>
        </header>

        <!-- Board -->
        <div class="board-container">
            <div class="kanban-board">
                <div class="column" data-status="notstarted">
                    <div class="column-header">
                        <span>Not Started</span>
                        <span class="column-count">0</span>
                    </div>
                    <div class="column-body" id="notstarted-column"></div>
                </div>

                <div class="column" data-status="inprogress">
                    <div class="column-header">
                        <span>In Progress</span>
                        <span class="column-count">0</span>
                    </div>
                    <div class="column-body" id="inprogress-column"></div>
                </div>

                <div class="column" data-status="inreview">
                    <div class="column-header">
                        <span>In Review</span>
                        <span class="column-count">0</span>
                    </div>
                    <div class="column-body" id="inreview-column"></div>
                </div>

                <div class="column" data-status="blocked">
                    <div class="column-header">
                        <span>Blocked</span>
                        <span class="column-count">0</span>
                    </div>
                    <div class="column-body" id="blocked-column"></div>
                </div>

                <div class="column" data-status="complete">
                    <div class="column-header">
                        <span>Complete</span>
                        <span class="column-count">0</span>
                    </div>
                    <div class="column-body" id="complete-column"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Task Dialog -->
    <div class="modal-overlay" id="newTaskDialog">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">New Task</h3>
                <button class="modal-close" id="closeNewDialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="taskDescription">Task Description</label>
                    <input class="form-input" id="taskDescription" type="text" placeholder="What needs to be done?" />
                </div>
                <div class="form-group">
                    <label class="form-label" for="taskDetails">Details</label>
                    <textarea class="form-textarea" id="taskDetails" rows="3"
                        placeholder="Add more context..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Steps</label>
                    <div id="newTaskStepsContainer" class="steps-container">
                        <!-- Dynamic inputs will be added here -->
                    </div>
                    <button class="btn btn-secondary btn-sm mt-2" id="addNewStepBtn">
                        <i data-feather="plus"></i> Add Step
                    </button>
                </div>
                <div class="flex gap-2">
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label" for="taskDueDate">Due Date</label>
                        <input class="form-input" id="taskDueDate" type="date" />
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">Labels</label>
                        <div id="taskLabelPickerContainer"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTaskBtn">Cancel</button>
                <button class="btn btn-primary" id="createTaskBtn">Create Task</button>
            </div>
        </div>
    </div>

    <!-- Task Details Dialog -->
    <div class="modal-overlay" id="taskDetailsDialog">
        <div class="modal large-modal">
            <div class="modal-header">
                <h3 class="modal-title">Task Details</h3>
                <button class="modal-close" id="closeDetailsDialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab-button active" data-tab="general">General</button>
                    <button class="tab-button" data-tab="steps">Steps</button>
                    <button class="tab-button" data-tab="comments">Comments</button>
                </div>

                <!-- General Tab -->
                <div class="tab-content" id="tab-general">
                    <div class="form-group">
                        <label class="form-label" for="detailDescription">Description</label>
                        <input class="form-input" id="detailDescription" type="text" />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="detailDetails">Details</label>
                        <textarea class="form-textarea" id="detailDetails" rows="6"></textarea>
                    </div>

                    <div class="flex gap-2">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label" for="detailDueDate">Due Date</label>
                            <input class="form-input" id="detailDueDate" type="date" />
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Labels</label>
                            <div id="detailLabelPickerContainer"></div>
                        </div>
                    </div>

                    <div class="form-group"
                        style="background: var(--bg-column); padding: var(--spacing-md); border-radius: var(--radius-md);">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-sm font-bold">Time Tracking</div>
                                <div id="timeDisplay"
                                    style="font-family: monospace; font-size: 1.25rem; font-weight: 600; margin-top: 4px;">
                                    00:00:00</div>
                                <div id="totalTimeDisplay" class="text-sm text-muted">Total: 0h 0m</div>
                            </div>
                            <button class="btn btn-secondary" id="startStopTimer">Start Timer</button>
                        </div>
                    </div>
                </div>

                <!-- Steps Tab -->
                <div class="tab-content hidden" id="tab-steps">
                    <div id="stepsList" class="mb-4"></div>
                    <div class="flex gap-2 mt-4">
                        <input class="form-input" id="newStepInput" type="text" placeholder="Add new step..."
                            style="flex: 1;" />
                        <button class="btn btn-secondary" id="addStepBtn">Add</button>
                    </div>
                </div>

                <!-- Comments Tab -->
                <div class="tab-content hidden" id="tab-comments">
                    <div id="commentsList"
                        style="max-height: 300px; overflow-y: auto; margin-bottom: var(--spacing-md);"></div>
                    <div class="form-group">
                        <textarea class="form-textarea" id="newComment" rows="3"
                            placeholder="Write a comment..."></textarea>
                    </div>
                    <div class="flex justify-end">
                        <button class="btn btn-primary" id="addCommentBtn">Post Comment</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-between">
                <div class="flex gap-2">
                    <button class="btn btn-secondary" id="archiveTaskBtn">Archive</button>
                    <button class="btn btn-danger" id="deleteTaskBtn">Delete</button>
                </div>
                <div class="flex gap-2">
                    <button class="btn btn-secondary" id="closeDetailsBtn">Close</button>
                    <button class="btn btn-primary" id="saveDetailsBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div class="modal-overlay" id="confirmDialog">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Action</h3>
                <button class="modal-close" id="closeConfirmDialog">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="confirmNoBtn">Cancel</button>
                <button class="btn btn-danger" id="confirmYesBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Alert Dialog -->
    <div class="modal-overlay" id="alertDialog">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">Notice</h3>
                <button class="modal-close" id="closeAlertDialog">&times;</button>
            </div>
            <div class="modal-body">
                <p id="alertMessage"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="alertOkBtn">OK</button>
            </div>
        </div>
    </div>

    <!-- Preferences Dialog -->
    <div class="modal-overlay" id="preferencesDialog">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Preferences</h3>
                <button class="modal-close" id="closePreferencesDialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="prefHideCompleted" />
                        <span>Hide completed tasks</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="prefConfirmDelete" />
                        <span>Show delete confirmations</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="prefEnableSounds" />
                        <span>Enable sound effects</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label" for="prefTheme">Theme</label>
                    <select class="form-select" id="prefTheme">
                        <option value="dark">Everforest Dark</option>
                        <option value="light">Everforest Light</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="prefAutoRefresh">Auto-refresh</label>
                    <select class="form-select" id="prefAutoRefresh">
                        <option value="0">Disabled</option>
                        <option value="30">30 seconds</option>
                        <option value="60">1 minute</option>
                        <option value="300">5 minutes</option>
                    </select>
                </div>

                <div class="mt-4 pt-4 border-t border-gray-200">
                    <button class="btn btn-secondary w-full" id="clearCompletedBtn">Clear All Completed Tasks</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPreferencesBtn">Cancel</button>
                <button class="btn btn-primary" id="savePreferencesBtn">Save Preferences</button>
            </div>
        </div>
    </div>

    <!-- Archive Viewer Dialog -->
    <div class="modal-overlay" id="archiveDialog">
        <div class="modal large-modal">
            <div class="modal-header">
                <h3 class="modal-title">Archived Tasks</h3>
                <button class="modal-close" id="closeArchiveDialog">&times;</button>
            </div>
            <div class="modal-body">
                <div style="max-height: 400px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse; text-align: left;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--border-color);">
                                <th style="padding: var(--spacing-sm);">ID</th>
                                <th style="padding: var(--spacing-sm);">Task</th>
                                <th style="padding: var(--spacing-sm);">Archived At</th>
                                <th style="padding: var(--spacing-sm); text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="archiveList">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeArchiveBtn">Close</button>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>
</body>

</html>